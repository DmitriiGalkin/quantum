import * as React from 'react';
import Typography from '@mui/material/Typography';
import {usePlace} from "../modules/place";
import {Box, Stack} from "@mui/material";
import ProjectCard from "../components/cards/ProjectCard";
import {Outlet, useNavigate, useParams} from "react-router-dom";
import Back from "../components/Back";
import QContainer from "../components/QContainer";
import {More} from "../components/More";
import Meets from "../components/Meets";
import Grid from '@mui/material/Unstable_Grid2';
import MeetComponent from "../components/Meet";
import {LocalDate} from "@js-joda/core";
import {useEffect, useState} from "react";
import {DASHBOARD_TICK_TIME, getFilteredMeetsByDate, getMeetsGroup2, getWeek} from "../tools/helper";
import {Meet} from "../modules/meet";
import {convertToMeetsGroupTime} from "../tools/date";

export default function DashboardPlace() {
    const { id: placeId } = useParams();
    const { data: place } = usePlace(Number(placeId))
    const meets = place?.meets || []
    const [selectedMeet, setSelectedMeet] = useState<Meet | undefined>()

    const meetsGroup = getMeetsGroup2(meets)
    const week = getWeek(convertToMeetsGroupTime(selectedMeet?.datetime), meetsGroup)
    const filteredMeets = getFilteredMeetsByDate(meets, convertToMeetsGroupTime(selectedMeet?.datetime))

    useEffect(() => {
        const timer = setTimeout(() => {
            if (meetsGroup.length) {
                const index = meets.findIndex(i => i.datetime === selectedMeet?.datetime)
                const date = index < (meets.length - 1) ? meets[index+1] : meets[0]
                setSelectedMeet(date)
            }
        }, DASHBOARD_TICK_TIME);
        return () => clearInterval(timer);
    }, [meetsGroup, selectedMeet]);

    useEffect(() => {
        setSelectedMeet(place?.meets[0])
    }, [place]);

    if (!place) return null;

    return (
        <>
            <div style={{ position: 'sticky', padding: '15px 15px 14px 15px', background: 'linear-gradient(180deg, #FFB628 0%, #FF8F28 100%)' }}>
                <Stack spacing={2} direction="row" justifyContent="space-between" style={{ width: '100%' }}>
                    <svg width="98" height="26" viewBox="0 0 98 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fillRule="evenodd" clipRule="evenodd" d="M19.8159 13.0468C19.8159 17.1482 16.4911 20.473 12.3897 20.473C8.28829 20.473 4.96345 17.1482 4.96345 13.0468C4.96345 8.94539 8.28829 5.62055 12.3897 5.62055C16.4911 5.62055 19.8159 8.94539 19.8159 13.0468ZM16.9671 24.2688C15.5548 24.8455 14.0094 25.1633 12.3897 25.1633C5.69793 25.1633 0.273193 19.7385 0.273193 13.0468C0.273193 6.35504 5.69793 0.930298 12.3897 0.930298C19.0814 0.930298 24.5062 6.35504 24.5062 13.0468C24.5062 15.4155 23.8265 17.6254 22.6515 19.4922C22.0547 19.1229 21.351 18.9097 20.5976 18.9097C18.439 18.9097 16.6891 20.6596 16.6891 22.8182C16.6891 23.3308 16.7877 23.8203 16.9671 24.2688Z" fill="white"/>
                        <circle cx="20.5976" cy="22.8183" r="2.34513" fill="white"/>
                        <path d="M32.9348 18.3212C30.8545 18.3212 29.2093 16.7847 29.2093 14.5685V8.62674H30.1339V14.5957C30.1339 16.3089 31.3712 17.4646 32.9348 17.4646C34.4848 17.4646 35.7357 16.3089 35.7357 14.5957V8.62674H36.6467V14.5685C36.6467 16.7847 35.0151 18.3212 32.9348 18.3212ZM48.5762 18.1444H47.6108L46.9718 15.765H41.4651L40.8125 18.1444H39.8471L42.5121 8.62674H45.9112L48.5762 18.1444ZM43.1783 9.55131L41.7099 14.9084H46.727L45.2722 9.55131H43.1783ZM59.3185 17.2742V8.62674H60.2295V18.1444H58.0676L54.1246 9.49693H53.3904V18.1444H52.4658V8.62674H54.7092L58.6523 17.2742H59.3185ZM63.8774 8.62674H71.2196V9.49693H68.0108V18.1444H67.0862V9.49693H63.8774V8.62674ZM78.4449 18.3212C76.3646 18.3212 74.7194 16.7847 74.7194 14.5685V8.62674H75.644V14.5957C75.644 16.3089 76.8813 17.4646 78.4449 17.4646C79.9949 17.4646 81.2458 16.3089 81.2458 14.5957V8.62674H82.1568V14.5685C82.1568 16.7847 80.5252 18.3212 78.4449 18.3212ZM97.7924 18.1444H96.8406L96.052 9.49693H95.3994L92.6393 18.1444H91.0756L88.3291 9.49693H87.6765L86.8879 18.1444H85.9361L86.8335 8.62674H89.0633L91.7147 17.2742H92.0274L94.6652 8.62674H96.895L97.7924 18.1444Z" fill="white"/>
                        <path d="M29.2093 8.62674V8.29927H28.8818V8.62674H29.2093ZM30.1339 8.62674H30.4614V8.29927H30.1339V8.62674ZM35.7357 8.62674V8.29927H35.4082V8.62674H35.7357ZM36.6467 8.62674H36.9742V8.29927H36.6467V8.62674ZM32.9348 17.9937C31.0306 17.9937 29.5368 16.5992 29.5368 14.5685H28.8818C28.8818 16.9703 30.6784 18.6486 32.9348 18.6486V17.9937ZM29.5368 14.5685V8.62674H28.8818V14.5685H29.5368ZM29.2093 8.95421H30.1339V8.29927H29.2093V8.95421ZM29.8064 8.62674V14.5957H30.4614V8.62674H29.8064ZM29.8064 14.5957C29.8064 16.4908 31.1914 17.792 32.9348 17.792V17.1371C31.551 17.1371 30.4614 16.127 30.4614 14.5957H29.8064ZM32.9348 17.792C34.6636 17.792 36.0632 16.4918 36.0632 14.5957H35.4082C35.4082 16.1259 34.306 17.1371 32.9348 17.1371V17.792ZM36.0632 14.5957V8.62674H35.4082V14.5957H36.0632ZM35.7357 8.95421H36.6467V8.29927H35.7357V8.95421ZM36.3192 8.62674V14.5685H36.9742V8.62674H36.3192ZM36.3192 14.5685C36.3192 16.6007 34.8374 17.9937 32.9348 17.9937V18.6486C35.1928 18.6486 36.9742 16.9688 36.9742 14.5685H36.3192ZM48.5762 18.1444V18.4719H49.0079L48.8915 18.0561L48.5762 18.1444ZM47.6108 18.1444L47.2945 18.2293L47.3597 18.4719H47.6108V18.1444ZM46.9718 15.765L47.288 15.6801L47.2229 15.4375H46.9718V15.765ZM41.4651 15.765V15.4375H41.2154L41.1493 15.6784L41.4651 15.765ZM40.8125 18.1444V18.4719H41.0622L41.1283 18.231L40.8125 18.1444ZM39.8471 18.1444L39.5318 18.0561L39.4154 18.4719H39.8471V18.1444ZM42.5121 8.62674V8.29927H42.2637L42.1967 8.53844L42.5121 8.62674ZM45.9112 8.62674L46.2266 8.53844L46.1596 8.29927H45.9112V8.62674ZM43.1783 9.55131V9.22384H42.9285L42.8625 9.46474L43.1783 9.55131ZM41.7099 14.9084L41.394 14.8218L41.2805 15.2359H41.7099V14.9084ZM46.727 14.9084V15.2359H47.1553L47.0431 14.8226L46.727 14.9084ZM45.2722 9.55131L45.5882 9.46549L45.5226 9.22384H45.2722V9.55131ZM48.5762 17.8169H47.6108V18.4719H48.5762V17.8169ZM47.9271 18.0595L47.288 15.6801L46.6555 15.8499L47.2945 18.2293L47.9271 18.0595ZM46.9718 15.4375H41.4651V16.0925H46.9718V15.4375ZM41.1493 15.6784L40.4967 18.0578L41.1283 18.231L41.7809 15.8516L41.1493 15.6784ZM40.8125 17.8169H39.8471V18.4719H40.8125V17.8169ZM40.1625 18.2327L42.8274 8.71504L42.1967 8.53844L39.5318 18.0561L40.1625 18.2327ZM42.5121 8.95421H45.9112V8.29927H42.5121V8.95421ZM45.5959 8.71504L48.2608 18.2327L48.8915 18.0561L46.2266 8.53844L45.5959 8.71504ZM42.8625 9.46474L41.394 14.8218L42.0257 14.995L43.4941 9.63789L42.8625 9.46474ZM41.7099 15.2359H46.727V14.5809H41.7099V15.2359ZM47.0431 14.8226L45.5882 9.46549L44.9562 9.63714L46.411 14.9942L47.0431 14.8226ZM45.2722 9.22384H43.1783V9.87879H45.2722V9.22384ZM59.3185 17.2742V17.6017H59.646V17.2742H59.3185ZM59.3185 8.62674V8.29927H58.991V8.62674H59.3185ZM60.2295 8.62674H60.5569V8.29927H60.2295V8.62674ZM60.2295 18.1444V18.4719H60.5569V18.1444H60.2295ZM58.0676 18.1444L57.7696 18.2803L57.857 18.4719H58.0676V18.1444ZM54.1246 9.49693L54.4225 9.36107L54.3352 9.16946H54.1246V9.49693ZM53.3904 9.49693V9.16946H53.0629V9.49693H53.3904ZM53.3904 18.1444V18.4719H53.7178V18.1444H53.3904ZM52.4658 18.1444H52.1383V18.4719H52.4658V18.1444ZM52.4658 8.62674V8.29927H52.1383V8.62674H52.4658ZM54.7092 8.62674L55.0072 8.49088L54.9198 8.29927H54.7092V8.62674ZM58.6523 17.2742L58.3543 17.4101L58.4417 17.6017H58.6523V17.2742ZM59.646 17.2742V8.62674H58.991V17.2742H59.646ZM59.3185 8.95421H60.2295V8.29927H59.3185V8.95421ZM59.902 8.62674V18.1444H60.5569V8.62674H59.902ZM60.2295 17.8169H58.0676V18.4719H60.2295V17.8169ZM58.3656 18.0085L54.4225 9.36107L53.8266 9.63279L57.7696 18.2803L58.3656 18.0085ZM54.1246 9.16946H53.3904V9.8244H54.1246V9.16946ZM53.0629 9.49693V18.1444H53.7178V9.49693H53.0629ZM53.3904 17.8169H52.4658V18.4719H53.3904V17.8169ZM52.7933 18.1444V8.62674H52.1383V18.1444H52.7933ZM52.4658 8.95421H54.7092V8.29927H52.4658V8.95421ZM54.4113 8.7626L58.3543 17.4101L58.9502 17.1384L55.0072 8.49088L54.4113 8.7626ZM58.6523 17.6017H59.3185V16.9467H58.6523V17.6017ZM63.8774 8.62674V8.29927H63.5499V8.62674H63.8774ZM71.2196 8.62674H71.5471V8.29927H71.2196V8.62674ZM71.2196 9.49693V9.8244H71.5471V9.49693H71.2196ZM68.0108 9.49693V9.16946H67.6833V9.49693H68.0108ZM68.0108 18.1444V18.4719H68.3383V18.1444H68.0108ZM67.0862 18.1444H66.7588V18.4719H67.0862V18.1444ZM67.0862 9.49693H67.4137V9.16946H67.0862V9.49693ZM63.8774 9.49693H63.5499V9.8244H63.8774V9.49693ZM63.8774 8.95421H71.2196V8.29927H63.8774V8.95421ZM70.8922 8.62674V9.49693H71.5471V8.62674H70.8922ZM71.2196 9.16946H68.0108V9.8244H71.2196V9.16946ZM67.6833 9.49693V18.1444H68.3383V9.49693H67.6833ZM68.0108 17.8169H67.0862V18.4719H68.0108V17.8169ZM67.4137 18.1444V9.49693H66.7588V18.1444H67.4137ZM67.0862 9.16946H63.8774V9.8244H67.0862V9.16946ZM64.2049 9.49693V8.62674H63.5499V9.49693H64.2049ZM74.7194 8.62674V8.29927H74.3919V8.62674H74.7194ZM75.644 8.62674H75.9714V8.29927H75.644V8.62674ZM81.2458 8.62674V8.29927H80.9183V8.62674H81.2458ZM82.1568 8.62674H82.4842V8.29927H82.1568V8.62674ZM78.4449 17.9937C76.5407 17.9937 75.0469 16.5992 75.0469 14.5685H74.3919C74.3919 16.9703 76.1885 18.6486 78.4449 18.6486V17.9937ZM75.0469 14.5685V8.62674H74.3919V14.5685H75.0469ZM74.7194 8.95421H75.644V8.29927H74.7194V8.95421ZM75.3165 8.62674V14.5957H75.9714V8.62674H75.3165ZM75.3165 14.5957C75.3165 16.4908 76.7014 17.792 78.4449 17.792V17.1371C77.0611 17.1371 75.9714 16.127 75.9714 14.5957H75.3165ZM78.4449 17.792C80.1737 17.792 81.5733 16.4918 81.5733 14.5957H80.9183C80.9183 16.1259 79.8161 17.1371 78.4449 17.1371V17.792ZM81.5733 14.5957V8.62674H80.9183V14.5957H81.5733ZM81.2458 8.95421H82.1568V8.29927H81.2458V8.95421ZM81.8293 8.62674V14.5685H82.4842V8.62674H81.8293ZM81.8293 14.5685C81.8293 16.6007 80.3475 17.9937 78.4449 17.9937V18.6486C80.7029 18.6486 82.4842 16.9688 82.4842 14.5685H81.8293ZM97.7924 18.1444V18.4719H98.1522L98.1184 18.1137L97.7924 18.1444ZM96.8406 18.1444L96.5145 18.1741L96.5417 18.4719H96.8406V18.1444ZM96.052 9.49693L96.3781 9.46719L96.351 9.16946H96.052V9.49693ZM95.3994 9.49693V9.16946H95.1602L95.0874 9.39735L95.3994 9.49693ZM92.6393 18.1444V18.4719H92.8785L92.9512 18.244L92.6393 18.1444ZM91.0756 18.1444L90.7635 18.2435L90.8361 18.4719H91.0756V18.1444ZM88.3291 9.49693L88.6412 9.3978L88.5687 9.16946H88.3291V9.49693ZM87.6765 9.49693V9.16946H87.3775L87.3504 9.46719L87.6765 9.49693ZM86.8879 18.1444V18.4719H87.1868L87.214 18.1741L86.8879 18.1444ZM85.9361 18.1444L85.6101 18.1137L85.5763 18.4719H85.9361V18.1444ZM86.8335 8.62674V8.29927H86.5354L86.5075 8.596L86.8335 8.62674ZM89.0633 8.62674L89.3764 8.53075L89.3055 8.29927H89.0633V8.62674ZM91.7147 17.2742L91.4016 17.3702L91.4726 17.6017H91.7147V17.2742ZM92.0274 17.2742V17.6017H92.2699L92.3406 17.3698L92.0274 17.2742ZM94.6652 8.62674V8.29927H94.4227L94.3519 8.5312L94.6652 8.62674ZM96.895 8.62674L97.221 8.596L97.1931 8.29927H96.895V8.62674ZM97.7924 17.8169H96.8406V18.4719H97.7924V17.8169ZM97.1667 18.1147L96.3781 9.46719L95.7259 9.52667L96.5145 18.1741L97.1667 18.1147ZM96.052 9.16946H95.3994V9.8244H96.052V9.16946ZM95.0874 9.39735L92.3273 18.0448L92.9512 18.244L95.7113 9.5965L95.0874 9.39735ZM92.6393 17.8169H91.0756V18.4719H92.6393V17.8169ZM91.3877 18.0453L88.6412 9.3978L88.017 9.59606L90.7635 18.2435L91.3877 18.0453ZM88.3291 9.16946H87.6765V9.8244H88.3291V9.16946ZM87.3504 9.46719L86.5617 18.1147L87.214 18.1741L88.0026 9.52667L87.3504 9.46719ZM86.8879 17.8169H85.9361V18.4719H86.8879V17.8169ZM86.2621 18.1751L87.1595 8.65748L86.5075 8.596L85.6101 18.1137L86.2621 18.1751ZM86.8335 8.95421H89.0633V8.29927H86.8335V8.95421ZM88.7502 8.72273L91.4016 17.3702L92.0278 17.1782L89.3764 8.53075L88.7502 8.72273ZM91.7147 17.6017H92.0274V16.9467H91.7147V17.6017ZM92.3406 17.3698L94.9784 8.72228L94.3519 8.5312L91.7142 17.1787L92.3406 17.3698ZM94.6652 8.95421H96.895V8.29927H94.6652V8.95421ZM96.569 8.65748L97.4664 18.1751L98.1184 18.1137L97.221 8.596L96.569 8.65748Z" fill="white"/>
                    </svg>
                    <Stack spacing={4} direction="row" justifyContent="space-between" alignItems="center">
                        <div>{place.title}</div>
                    </Stack>
                </Stack>
            </div>
            <div style={{minHeight: '100vh', height: '100%', backgroundColor: '#F5F5F5'}}>
                <Grid container spacing={2}>
                    <Grid xs={4}>
                        <Meets
                            meets={filteredMeets}
                            selectedMeet={selectedMeet}
                            week={week}
                        />
                    </Grid>
                    <Grid xs={4}>
                        {selectedMeet && <MeetComponent meet={selectedMeet}/>}
                    </Grid>
                    <Grid xs={4}>
                        {selectedMeet && <ProjectCard project={selectedMeet?.project}/>}
                    </Grid>
                </Grid>
            </div>
        </>
    );
}
